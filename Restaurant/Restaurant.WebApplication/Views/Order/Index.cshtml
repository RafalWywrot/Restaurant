@model IEnumerable<Restaurant.Domain.DTO.OrderDTO>

@{
    ViewBag.Title = "Index";
}

<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.OrderDate)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Status)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.PickupDate)
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.OrderDate)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Status)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.PickupDate)
            </td>
            <td></td>
        </tr>

        <tr>
            <th style="padding-left: 20px;">
                @Html.Name("Nazwa")
            </th>
            <th>
                @Html.Name("Ilość")
            </th>
            <th></th>
        </tr>
        foreach (var orderItem in item.OrderItems)
        {
            <tr style="border: none;">
                @Html.HiddenFor(x => orderItem.Id, new { @class = "orderItemId" })
                <td style="padding-left: 20px;">
                    @Html.DisplayFor(modelItem => orderItem.Menu.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => orderItem.Quantity)
                </td>
                <td>
                    <input type="button" value="Usuń" class="btn btn-danger remove-order" />
                </td>
            </tr>
        }
    }
</table>

@section Scripts {
    <script>
        $(".remove-order").click(function () {
            var row = $(this).closest("tr");
            var options =
            {
                DeclineButtonClasses: "btn btn-default",
                ConfimButtonClasses: "btn btn-default margin-left-lg"
            };
            var confirmDialog = new ConfirmDialog(options);
            confirmDialog.ShowDialog(
                "text 1",
                "Content",
                "Yes",
                "No",
                function () {
                    $.ajax({
                        url: '@Url.Action("Remove", "Order")',
                        type: "POST",
                        contentType: 'application/json',
                        datatype: 'json',
                        data: JSON.stringify({
                            'orderItemId': row.find('.orderItemId').val()
                        }),
                        success: function (response) { // remove buttons and replace by message response by server
                            if (response) {
                                if (row.siblings().length > 0) {
                                    location.reload();
                                }
                                else {
                                    row.remove();
                                }
                            }
                            else {
                                alert('no response');
                            }
                        },
                        error: function (xhr) { alert('big error') }
                    });
                },
                function () { }
            );
    });
    </script>
}